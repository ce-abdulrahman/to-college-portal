 <?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Foundation\Auth\User as Authenticatable;
use Illuminate\Notifications\Notifiable;
use Laravel\Sanctum\HasApiTokens;

class User extends Authenticatable
{
    use HasApiTokens, HasFactory, Notifiable;

    protected $fillable = [
        'name', 'code', 'password', 'role', 'status', 'phone', 'rand_code',
    ];

    protected $hidden = [
        'password',
        'remember_token',
    ];

    protected $casts = [
        // Remove email_verified_at if you don't use emails
        'code' => 'integer',          // ✅ make code an integer
        'rand_code' => 'integer',     // ✅ make rand_code an integer
        'password' => 'hashed',
    ];

    /**
     * Tell Laravel which column is the auth identifier (instead of 'email')
     */
    public function getAuthIdentifierName(): string
    {
        return 'code';                // ✅ use 'code' for auth
    }

    public function teacher()
    {
        return $this->belongsTo(Teacher::class);
    }

    public function student()
    {
        return $this->belongsTo(Student::class);
    }
}



<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class Student extends Model
{
    use HasFactory;

    protected $table = 'students';
    protected $primaryKey = 'id';

    protected $fillable = [
        'user_id',
        'mark',
        'province',
        'type',
        'gender',
        'year',
        'referral_code',
        'status',
        'mbti_type',
    ];

    public function user()
    {
        return $this->belongsTo(User::class);
    }

    public function resultDeps()
    {
        return $this->hasMany(ResultDep::class, 'student_id');
    }

    public function mbtiAnswers()
    {
        return $this->hasMany(MbtiAnswer::class);
    }

    // Accessor بۆ ناوی تەواوی جۆری MBTI
    public function getMbtiFullNameAttribute()
    {
        $types = [
            'ISTJ' => 'Introverted Sensor Thinker Judger',
            'ISFJ' => 'Introverted Sensor Feeler Judger',
            'INFJ' => 'Introverted Intuitive Feeler Judger',
            'INTJ' => 'Introverted Intuitive Thinker Judger',
            'ISTP' => 'Introverted Sensor Thinker Perceiver',
            'ISFP' => 'Introverted Sensor Feeler Perceiver',
            'INFP' => 'Introverted Intuitive Feeler Perceiver',
            'INTP' => 'Introverted Intuitive Thinker Perceiver',
            'ESTP' => 'Extraverted Sensor Thinker Perceiver',
            'ESFP' => 'Extraverted Sensor Feeler Perceiver',
            'ENFP' => 'Extraverted Intuitive Feeler Perceiver',
            'ENTP' => 'Extraverted Intuitive Thinker Perceiver',
            'ESTJ' => 'Extraverted Sensor Thinker Judger',
            'ESFJ' => 'Extraverted Sensor Feeler Judger',
            'ENFJ' => 'Extraverted Intuitive Feeler Judger',
            'ENTJ' => 'Extraverted Intuitive Thinker Judger',
        ];

        return $types[$this->mbti_type] ?? 'دیاری نەکراو';
    }

    // Accessor بۆ وەسفی کوردی
    public function getMbtiKurdishDescriptionAttribute()
    {
        $descriptions = [
            'ISTJ' => 'کەسێکی ئاسوودەخواز و ڕێکخراو',
            'ISFP' => 'کەسێکی هونەرمەند و هەستیار',
            'INFP' => 'کەسێکی ئایدیالیست و میهرەبان',
            'ESFJ' => 'کەسێکی بەخێوکەر و کۆمەڵایەتی',
            // ... بۆ هەموو جۆرەکان
        ];

        return $descriptions[$this->mbti_type] ?? 'هیچ زانیاریەک بوونی نییە';
    }

    // پشکنین ئەگەر تاقیکردنەوەی کردبێت
    public function hasCompletedMbtiTest()
    {
        return !empty($this->mbti_type) || $this->mbtiAnswers()->exists();
    }
}



<?php
// app/Models/MbtiAnswer.php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class MbtiAnswer extends Model
{
    protected $fillable = [
        'user_id',
        'student_id',
        'question_id',
        'score'
    ];

    protected $casts = [
        'score' => 'integer',
    ];

    // پەیوەندی بە بەکارهێنەرەوە
    public function user()
    {
        return $this->belongsTo(User::class);
    }

    // پەیوەندی بە پرسیارەوە
    public function question()
    {
        return $this->belongsTo(MbtiQuestion::class);
    }

    // Static method بۆ هەژمارکردنی ئەنجامی بەکارهێنەرێک
    public static function calculateResult($userId)
    {
        $answers = self::where('user_id', $userId)
                      ->with('question')
                      ->get();

        if ($answers->isEmpty()) {
            return null;
        }

        $scores = [
            'E' => 0, 'I' => 0,
            'S' => 0, 'N' => 0,
            'T' => 0, 'F' => 0,
            'J' => 0, 'P' => 0,
        ];

        foreach ($answers as $answer) {
            $side = $answer->question->side;
            $scores[$side] += $answer->score;
        }

        // دیاریکردنی جۆری MBTI
        $mbtiType = '';
        $mbtiType .= ($scores['E'] > $scores['I']) ? 'E' : 'I';
        $mbtiType .= ($scores['S'] > $scores['N']) ? 'S' : 'N';
        $mbtiType .= ($scores['T'] > $scores['F']) ? 'T' : 'F';
        $mbtiType .= ($scores['J'] > $scores['P']) ? 'J' : 'P';

        return $mbtiType;
    }
}



<?php

// app/Models/MbtiQuestion.php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class MbtiQuestion extends Model
{
    protected $fillable = [
        'dimension',
        'side',
        'question_ku',
        'question_en',
        'order'
    ];

    protected $casts = [
        'order' => 'integer',
    ];

    // پەیوەندی بە وەڵامەکانەوە
    public function answers()
    {
        return $this->hasMany(MbtiAnswer::class, 'question_id');
    }

    // Static method بۆ وەرگرتنی پرسیارەکان بە شێوەی ڕیزبەندکراو
    public static function getGroupedQuestions()
    {
        return self::orderBy('dimension')
                  ->orderBy('order')
                  ->get()
                  ->groupBy('dimension');
    }
}
